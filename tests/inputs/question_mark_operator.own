rt :: import = std.runtime

printf :: extern("c")  :: fn(format_string u8*, args opaque...) i32

do_thing :: fn(should_succeed u1) rt.Optional(<i32>) {
    if should_succeed => return .some(9)
    return .none
}

do_thing_with_err_val :: fn(should_succeed u1) rt.Result(<i32, i64>) {
    if should_succeed => return .ok(9)
    return .error(27)
}

FALSE :: def = 0
TRUE :: def = 1

Token :: struct {
    string u8*
}

thing1 :: fn() {
    let num i32 = do_thing(FALSE)?
    printf("no1\n")
}

thing2 :: fn() {
    let num i32 = do_thing(TRUE)?
    printf("yes2: %d\n", num)
}

thing3 :: fn() {
    let num = do_thing(FALSE)?
    printf("no3\n")
}

thing4 :: fn() {
    do_thing(FALSE)?
    printf("no4\n")
}

thing5 :: fn() {
    let num = do_thing(TRUE)?
    printf("yes5: %d\n", num)
}

thing6 :: fn() {
    do_thing(TRUE)?
    printf("yes6\n")
}

thing7 :: fn() rt.Optional(<i32>) {
    do_thing(TRUE)?
    printf("yes7.1\n")
    return .some(8)
}

thing8 :: fn() rt.Optional(<i32>) {
    do_thing(FALSE)?
    printf("no7.1\n")
    return .some(8)
}

thing9 :: fn() rt.Optional(<i32>) {
    do_thing_with_err_val(FALSE)?
    printf("no9.1\n")
    return .some(8)
}

thing10 :: fn() {
    do_thing_with_err_val(FALSE)?
    printf("no10.1\n")
}

thing11 :: fn() rt.Optional(<i32>) {
    do_thing_with_err_val(TRUE)?
    printf("yes11.1\n")
    return .some(8)
}

thing12 :: fn() {
    do_thing_with_err_val(TRUE)?
    printf("yes12.1\n")
}

thing13 :: fn() rt.Result(<i32, i64>) {
    do_thing_with_err_val(TRUE)?
    printf("yes13.1\n")
    return .ok(7)
}

thing14 :: fn() rt.Result(<i32, i64>) {
    do_thing_with_err_val(FALSE)?
    printf("no14.1\n")
    return .ok(7)
}

main :: fn() i32 {
    thing1()
    thing2()
    thing3()
    thing4()
    thing5()
    thing6()

    switch thing7() {
        case .some: printf("yes7.2\n")
        case .none: printf("no7.2\n")
    }

    switch thing8() {
        case .some: printf("no8.2\n")
        case .none: printf("yes8.2\n")
    }

    switch thing9() {
        case .some: printf("no9.2\n")
        case .none: printf("yes9.2\n")
    }
    thing10()

    switch thing11() {
        case .some: printf("yes11.2\n")
        case .none: printf("no11.2\n")
    }
    thing12()

    switch thing13() {
        case .ok: printf("yes13.2\n")
        case .error: printf("no13.2\n")
    }
    thing14()

    return 0
}
