type io import = std.io

type Alloc struct {
    max_thing i32
}

type Token1 enum(<alloc ''Alloc>) {
    num i32
}

type Token2 enum(<max_cap ''i32, alloc ''Alloc>) {
    num i32
}

type Symbol struct(<print_fn ''fn()void>) {
    num i32
}

fn print_hello() {
    io.print_str("hello")
}

fn print_bye() {
    io.print_str("bye")
}

fn do_thing_with_alloc(alloc Alloc) {
    io.print_int(alloc.max_thing)
}

fn print_max1(<alloc ''Alloc>)(token Token1(<alloc>)) {
    do_thing_with_alloc(alloc)
}

fn print_max2(<max_cap ''i32, alloc ''Alloc>)(token Token2(<max_cap, alloc>)) {
    do_thing_with_alloc(alloc)
}

type ALLOC1 def = {.max_thing = 8}

fn struct_literal_tests() {
    let token1 Token1(<ALLOC1>) = .num(7)
    let token2 Token2(<87, {.max_thing = 903}>) = .num(7)
    print_max1(<ALLOC1>)(token1)
    print_max1(token1)
    print_max2(<87, {.max_thing = 903}>)(token2)
    print_max2(token2)
}

fn symbol_tests() {
    let symbol Symbol(<print_hello>) = {0}
    symbol.print_fn()
}

fn main() i32 {
    struct_literal_tests()
    symbol_tests()

    return 0
}
